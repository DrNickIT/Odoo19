<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_my_home_menu_consignment" name="Portal My Home: Consignment Menu"
              inherit_id="portal.portal_my_home" priority="99">
        <xpath expr="//div[hasclass('o_portal_my_home')]" position="inside">
            <style>
                a[href='/my/consignments'] .o_portal_icon img {
                max-height: 5em !important;
                width: auto !important;
                }
            </style>
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/otters_consignment/static/src/img/consignment_icon.png'"/>
                <t t-set="title">Mijn Inzendingen</t>
                <t t-set="text">Bekijk de status van je opgestuurde kleren</t>
                <t t-set="url" t-value="'/my/consignments'"/>
                <t t-set="config_card" t-value="True"/>
            </t>
        </xpath>
    </template>

    <template id="portal_my_consignments" name="Mijn Consignaties">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs" t-value="[
                ('my_home', {'title': 'Mijn Portaal'}),
                ('my_consignments', {'title': 'Mijn Inzendingen'})
            ]"/>

            <div class="container">
                <h3>Mijn Inzendingen</h3>
                <t t-if="not submissions">
                    <div class="alert alert-info" role="alert">
                        Je hebt nog geen inzendingen.
                    </div>
                </t>
                <t t-if="submissions">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Datum</th>
                                <th>Status</th>
                                <th>Uitbetaalmethode</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="submissions" t-as="submission">
                                <td>
                                    <a t-att-href="'/my/consignments/%s' % submission.id">
                                        <span t-field="submission.name"/>
                                    </a>
                                </td>
                                <td><span t-field="submission.submission_date" t-options="{'widget': 'date'}"/></td>
                                <td><span t-field="submission.state"/></td>
                                <td><span t-field="submission.payout_method"/></td>
                            </tr>
                        </tbody>
                    </table>
                </t>
                <div t-if="pager" class="o_portal_pager">
                    <t t-call="portal.pager"/>
                </div>
            </div>
        </t>
    </template>

    <template id="portal_consignment_submission" name="Consignatie Details">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs" t-value="[
                ('my_home', {'title': 'Mijn Portaal'}),
                ('my_consignments', {'title': 'Mijn Inzendingen', 'url': '/my/consignments'}),
                ('submission', {'title': submission.name})
            ]"/>

            <div class="card o_portal_details">
                <div class="card-header">
                    <div class="row">
                        <div class="col-md-8">
                            <h5 class="mb-0">
                                Inzending: <b t-field="submission.name"/>
                            </h5>
                            <div class="text-muted">
                                Status: <span t-field="submission.state"/>
                            </div>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <small class="text-muted">Uitbetaal-afspraak:</small><br/>
                            <strong t-if="submission.payout_method == 'cash'">
                                <span t-esc="'{:.0f}'.format(submission.payout_percentage * 100)"/>% in Cash
                            </strong>
                            <strong t-if="submission.payout_method == 'coupon'">
                                <span t-esc="'{:.0f}'.format(submission.payout_percentage * 100)"/>% in Tegoedbon
                            </strong>
                        </div>
                    </div>
                </div>

                <div class="card-body">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="stock-tab" data-bs-toggle="tab" href="#stock" role="tab" aria-controls="stock" aria-selected="true">
                                In Voorraad (<t t-esc="len(stock_products)"/>)
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="unpaid-tab" data-bs-toggle="tab" href="#unpaid" role="tab" aria-controls="unpaid" aria-selected="false">
                                Nog Uit te Betalen (<t t-esc="len(aggregated_unpaid)"/>)
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="paid-tab" data-bs-toggle="tab" href="#paid" role="tab" aria-controls="paid" aria-selected="false">
                                Reeds Uitbetaald (<t t-esc="len(aggregated_paid)"/>)
                            </a>
                        </li>
                    </ul>

                    <div class="tab-content pt-3" id="myTabContent">

                        <div class="tab-pane fade show active" id="stock" role="tabpanel" aria-labelledby="stock-tab">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th class="text-end">Jouw Prijs</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="stock_products" t-as="product">
                                        <td><span t-field="product.name"/></td>
                                        <td class="text-end">
                                            <span t-field="product.list_price" t-options="{'widget': 'monetary', 'display_currency': submission.supplier_id.currency_id}"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="tab-pane fade" id="unpaid" role="tabpanel" aria-labelledby="unpaid-tab">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th class="text-end">Aantal</th>
                                        <th class="text-end">Verkoopprijs</th>
                                        <th class="text-end">Jouw Uitbetaling</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="aggregated_unpaid" t-as="line">
                                        <td><span t-esc="line['name']"/></td>
                                        <td class="text-end"><span t-esc="line['qty']"/> st</td>
                                        <td class="text-end">
                                            <span t-esc="line['price_sold']" t-options="{'widget': 'monetary', 'display_currency': submission.supplier_id.currency_id}"/>
                                        </td>
                                        <td class="text-end">
                                            <span t-esc="line['payout']" t-options="{'widget': 'monetary', 'display_currency': submission.supplier_id.currency_id}"/>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr class="bg-light">
                                        <td colspan="3" class="text-end">
                                            <strong>Totaal nog uit te betalen:</strong>
                                        </td>
                                        <td class="text-end">
                                            <strong t-esc="total_payout_unpaid" t-options="{'widget': 'monetary', 'display_currency': submission.supplier_id.currency_id}"/>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                        <div class="tab-pane fade" id="paid" role="tabpanel" aria-labelledby="paid-tab">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th class="text-end">Aantal</th>
                                        <th class="text-end">Verkoopprijs</th>
                                        <th class="text-end">Uitbetaald Bedrag</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr t-foreach="aggregated_paid" t-as="line">
                                        <td><span t-esc="line['name']"/></td>
                                        <td class="text-end"><span t-esc="line['qty']"/> st</td>
                                        <td class="text-end">
                                            <span t-esc="line['price_sold']" t-options="{'widget': 'monetary', 'display_currency': submission.supplier_id.currency_id}"/>
                                        </td>
                                        <td class="text-end">
                                            <span t-esc="line['payout']" t-options="{'widget': 'monetary', 'display_currency': submission.supplier_id.currency_id}"/>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr class="bg-light">
                                        <td colspan="3" class="text-end">
                                            <strong>Totaal reeds uitbetaald:</strong>
                                        </td>
                                        <td class="text-end">
                                            <strong t-esc="total_payout_paid" t-options="{'widget': 'monetary', 'display_currency': submission.supplier_id.currency_id}"/>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
